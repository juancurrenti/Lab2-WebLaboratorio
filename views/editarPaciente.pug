extends layout

block content
  .container-fluid.mt-5
    h2.mb-4 Cambiar Contraseña


    if errorMessages && errorMessages.length > 0
      each msg in errorMessages
        .alert.alert-danger= msg
    

    form(method="POST" action="/portal-paciente/actualizar")
      .card.mb-4
        .card-body
          h5.card-title Ingrese los datos para el cambio
          .mb-3
            label.form-label Contraseña Actual
            input.form-control(
              type="password"
              name="password_actual"
              placeholder="Ingrese su contraseña actual"
              required
            )
          .mb-3
            label.form-label Nueva Contraseña
            input.form-control(
              type="password"
              name="nueva_password"
              placeholder="Ingrese la nueva contraseña"
              required
            )
      
      button.btn.btn-primary(type="submit") Cambiar Contraseña
      a.btn.btn-secondary.ms-2(href="/portal-paciente") Volver

  .modal.fade#successModal(tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true")
    .modal-dialog.modal-dialog-centered
      .modal-content
        .modal-header.bg-success.text-white
          h5.modal-title#successModalLabel ¡Éxito!
          button.btn-close.btn-close-white(type="button" data-bs-dismiss="modal" aria-label="Close")
        .modal-body
          p Tu contraseña ha sido modificada correctamente.
        .modal-footer
          button.btn.btn-success(type="button" data-bs-dismiss="modal") Cerrar


  script.
    document.addEventListener('DOMContentLoaded', function() {

      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('password_success') === 'true') {

        const successModal = new bootstrap.Modal(document.getElementById('successModal'));
        successModal.show();
        
        const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
        window.history.replaceState({path: cleanUrl}, '', cleanUrl);
      }
    });